package travellingSalemansProblem;

import java.io.*;
import java.util.ArrayList;
import java.util.List;
import java.util.Random;

import until.Methode;
import classesPb.*;

public class CertificatTSP implements Certificat{

	private TSP tsp;
	public List<String> tableauSolution;
	public int nbCertificatMax;
	public int pointeurCertficat;
	
	/**
	 * Constructeur
	 * @param tsp
	 */
	public CertificatTSP(TSP tsp){
		this.tsp=tsp;
		this.tableauSolution = new ArrayList<String>();
		this.nbCertificatMax = Methode.factorial( tsp.longueurTournee - 1 ) * tsp.longueurTournee;
	}

	
	public TSP getTsp() {
		return tsp;
	}

	public void setTsp(TSP tsp) {
		this.tsp = tsp;
	}

	
	public int genererAllCertificat(int valeurTournee, List<Integer> listVilleVisite){
		
		if(listVilleVisite.size() == getTsp().nbVilles){
				
			//Condition de sortie : Parcour invalide
			if( ( valeurTournee + this.getTsp().distances[listVilleVisite.get(listVilleVisite.size()-1)][listVilleVisite.get(0)] ) > this.getTsp().longueurTournee)
				return -1;
			else {
				
				String parcours = "";
				
				/** sauvegarde du certificat en base **/
				for(int m=0;m<listVilleVisite.size();m++)
					parcours += tsp.ville[listVilleVisite.get(m)] + " -> ";
				
				parcours += tsp.ville[listVilleVisite.get(0)];
				
				tableauSolution.add(parcours);
				
				/** retour la valeur du certificat **/
				return ( valeurTournee + this.getTsp().distances[listVilleVisite.get(listVilleVisite.size()-1)][listVilleVisite.get(0)] );
			}
		}
		
		
		for(int i=0;i<this.getTsp().nbVilles;i++){
			
			List<Integer> listTmp = listVilleVisite;
			
			if(!listTmp.contains(i)){
				
				listTmp.add(i);
				
				/** Condition de sortie : Ssi longueur entre 2 ville > a la tournee **/
				if( ( this.getTsp().distances[listTmp.get(listTmp.size()-1)][i] + valeurTournee ) > this.getTsp().longueurTournee)
					return -1;
				else{ 
					/** On continue de rechercher la suite de la tournee **/
					return genererAllCertificat( ( valeurTournee + this.getTsp().distances[listTmp.get(listTmp.size()-1)][i] ),listTmp);
				}
			}
		}
		return 0;
	}
	
	
	@Override
	public void saisie(String fichier) {	/** Methode "verification" propose à l'utilisateur de saisir un certificat et vérifie sa validité **/
		InputStream ips=new FileInputStream(fichier); 
		InputStreamReader ipsr=new InputStreamReader(ips);
		BufferedReader br=new BufferedReader(ipsr);
		String ligne;
		while ((ligne=br.readLine())!=null){
			int lgn = 0;
			if( lgn < 8 ){
				System.out.println(ligne);
			}else{
					
			}	
			
		}
		br.close(); 
	}		
				
	}

	@Override
	public void display() {
		
		
	}

	@Override
	public void alea() {
		if(tableauSolution.size() == 0){
			
		}else {
			
			/** Ssi tous les certificats sont en memoire **/
			if(tableauSolution.size() == nbCertificatMax){
				Random random = new Random();
				pointeurCertficat = random.nextInt(tableauSolution.size());
			}else{
				
			}
			
		}
		
	}

	@Override
	public void reset() {
		// TODO Auto-generated method stub
		
	}

	@Override
	public boolean estDernier() {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public void suivant() {
		// TODO Auto-generated method stub
		
	}

}
